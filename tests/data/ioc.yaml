checks:
  - cmd: kubectl get namespace bl45p -o name
    rsp: namespace/bl45p
  - cmd: kubectl get -n bl45p deploy/bl45p-ea-ioc-01
    rsp: bl45p-ea-ioc-01   1/1     1            1           5d5h

attach:
  - cmd: kubectl -it -n bl45p attach deploy/bl45p-ea-ioc-01
    rsp: True

delete:
  - cmd: helm delete -n bl45p bl45p-ea-ioc-01
    rsp: True

template:
  - cmd: 'bash -c "helm template bl45p-ea-ioc-01 /tmp/ec_tests/beamline-chart --version
      20.*--namespace bl45p -f .*\/data\/iocs\/bl45p-ea-ioc-01\/values.yaml.*'
    rsp: |
      # Source: bl45p-ea-ioc-01/templates/configmap.yaml
      apiVersion: v1
      ...

# TODO blank response is that OK?
deploy_local:
  - cmd: 'bash -c "helm upgrade --install bl45p-ea-ioc-01 /tmp/ec_tests/beamline-chart
      --version 20.*--namespace bl45p -f .*\/data\/iocs\/bl45p-ea-ioc-01\/values.yaml.*'
    rsp: ""

deploy:
  - cmd: git clone https://github.com/epics-containers/bl45p /tmp/ec_tests --depth=1 --single-branch=true --branch=2.0
    rsp: ""
  - cmd: 'bash -c "helm upgrade --install bl45p-ea-ioc-01 /tmp/ec_tests/beamline-chart --version 2.0 --namespace bl45p -f /tmp/ec_tests/iocs/bl45p-ea-ioc-01/values.yaml.*'
    rsp: ""

instances:
  - cmd: git clone https://github.com/epics-containers/bl45p /tmp/.*
    rsp: Cloning into /tmp/xxxx...
  - cmd: git tag
    rsp: |
      2.0
  - cmd: git diff --name-only 2.0 2.0\^
    rsp: |
      2.0
